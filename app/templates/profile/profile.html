{% extends "base.html" %}

{% block title %}{{ profile_user.display_name or profile_user.username }}'s Room - {{ app_name }}{% endblock %}

{% block content %}
<div class="profile-room" style="
    background-color: {{ profile_user.background_color }};
    color: {{ profile_user.text_color }};
    min-height: calc(100vh - 200px);
    padding: 2rem;
">
    <div class="profile-container">
        <!-- Profile Header -->
        <!-- Favorite Quote Banner -->
        {% if profile_user.favorite_quote %}
        <div class="quote-banner" style="border-color: {{ profile_user.accent_color }};">
            <span class="quote-mark left">"</span>
            <p class="quote-text">{{ profile_user.favorite_quote }}</p>
            <span class="quote-mark right">"</span>
        </div>
        {% endif %}

        <div class="profile-header" style="border-color: {{ profile_user.accent_color }};">
            <div class="profile-avatar">
                {% if profile_user.profile_picture %}
                <img src="{{ profile_user.profile_picture }}" alt="{{ profile_user.display_name or profile_user.username }}" class="avatar-image">
                {% else %}
                {{ profile_user.username[0].upper() }}
                {% endif %}
            </div>
            <div class="profile-info">
                <h1 class="profile-name">{{ profile_user.display_name or profile_user.username }}</h1>
                <p class="profile-username">@{{ profile_user.username }}</p>

                {% if profile_user.location %}
                <p class="profile-location">üìç {{ profile_user.location }}</p>
                {% endif %}

                <!-- Years Teaching Badge -->
                {% if profile_user.years_teaching %}
                <div class="experience-badge {% if profile_user.years_teaching >= 20 %}master{% elif profile_user.years_teaching >= 11 %}veteran{% elif profile_user.years_teaching >= 4 %}experienced{% else %}new-teacher{% endif %}">
                    <span class="badge-icon">
                        {% if profile_user.years_teaching >= 20 %}üèÜ{% elif profile_user.years_teaching >= 11 %}üéñÔ∏è{% elif profile_user.years_teaching >= 4 %}üìò{% else %}üå±{% endif %}
                    </span>
                    <span class="badge-text">{{ profile_user.years_teaching }} Year{% if profile_user.years_teaching != 1 %}s{% endif %} Teaching</span>
                </div>
                {% endif %}

                {% if profile_user.school %}
                <p class="profile-school">üè´ {{ profile_user.school }}</p>
                {% endif %}

                {% if profile_user.grade_level %}
                <p class="profile-grades">üìö {{ profile_user.grade_level }}</p>
                {% endif %}

                {% if profile_user.subjects_taught %}
                <p class="profile-subjects">üìñ {{ profile_user.subjects_taught }}</p>
                {% endif %}

                <div class="profile-stats">
                    <span class="stat-item" style="color: {{ profile_user.accent_color }};">
                        <strong>{{ total_favorites }}</strong> Favorites
                    </span>
                    <span class="stat-item visitor-counter-stat" style="color: {{ profile_user.accent_color }};">
                        <span class="counter-icon">üëÄ</span>
                        <strong>{{ total_visits }}</strong> Profile Views
                    </span>
                    <span class="stat-item" style="color: {{ profile_user.accent_color }};">
                        Member since <strong>{{ profile_user.created_at.strftime('%B %Y') }}</strong>
                    </span>
                </div>

                {% if is_own_profile %}
                <div class="profile-actions">
                    <a href="{{ url_for('main.edit_profile') }}" class="btn-edit-profile" style="background-color: {{ profile_user.accent_color }};">
                        ‚úèÔ∏è Customize My Room
                    </a>

                    {# Google Classroom integration - currently disabled (needs OAuth setup)
                    {% if profile_user.google_connected %}
                    <div class="google-classroom-status">
                        <span class="connected-badge">‚úì Google Classroom Connected</span>
                        <form method="POST" action="{{ url_for('main.google_disconnect') }}" style="display: inline;">
                            <button type="submit" class="btn-disconnect" onclick="return confirm('Disconnect Google Classroom?');">
                                Disconnect
                            </button>
                        </form>
                    </div>
                    {% else %}
                    <a href="{{ url_for('main.google_connect') }}" class="btn-connect-google">
                        <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-right: 8px;">
                            <path d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.875 2.684-6.615z" fill="#4285F4"/>
                            <path d="M9.003 18c2.43 0 4.467-.806 5.956-2.183l-2.908-2.259c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.96v2.332C2.44 15.983 5.485 18 9.003 18z" fill="#34A853"/>
                            <path d="M3.964 10.712c-.18-.54-.282-1.117-.282-1.71s.102-1.17.282-1.71V4.96H.957C.347 6.175 0 7.55 0 9.002c0 1.452.348 2.827.957 4.042l3.007-2.332z" fill="#FBBC05"/>
                            <path d="M9.003 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.464.891 11.428 0 9.003 0 5.485 0 2.44 2.017.96 4.958L3.967 7.29c.708-2.127 2.692-3.71 5.036-3.71z" fill="#EA4335"/>
                        </svg>
                        Connect Google Classroom
                    </a>
                    {% endif %}
                    #}
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Profile Content Grid -->
        <div class="profile-content-grid">
            <!-- About Me Section -->
            {% if profile_user.bio %}
            <div class="profile-section" style="border-color: {{ profile_user.accent_color }};">
                <h2 style="color: {{ profile_user.accent_color }};">About Me</h2>
                <p>{{ profile_user.bio }}</p>
            </div>
            {% endif %}

            <!-- Teaching Philosophy Section -->
            {% if profile_user.teaching_philosophy %}
            <div class="profile-section" style="border-color: {{ profile_user.accent_color }};">
                <h2 style="color: {{ profile_user.accent_color }};">Teaching Philosophy</h2>
                <p>{{ profile_user.teaching_philosophy }}</p>
            </div>
            {% endif %}

            <!-- Collaboration Board Section -->
            {% if (hasattr(profile_user, 'open_to_collaboration') and profile_user.open_to_collaboration) and ((hasattr(profile_user, 'looking_for') and profile_user.looking_for) or (hasattr(profile_user, 'can_help_with') and profile_user.can_help_with)) %}
            <div class="profile-section collaboration-board" style="border-color: {{ profile_user.accent_color }};">
                <h2 style="color: {{ profile_user.accent_color }};">ü§ù Collaboration Board</h2>
                <p class="collaboration-intro">Open to connecting with other educators!</p>

                <div class="collaboration-content">
                    {% if hasattr(profile_user, 'looking_for') and profile_user.looking_for %}
                    <div class="collaboration-item looking-for">
                        <div class="collaboration-header">
                            <span class="collaboration-icon">üîç</span>
                            <h3>Looking For</h3>
                        </div>
                        <p class="collaboration-text">{{ profile_user.looking_for }}</p>
                    </div>
                    {% endif %}

                    {% if hasattr(profile_user, 'can_help_with') and profile_user.can_help_with %}
                    <div class="collaboration-item can-help">
                        <div class="collaboration-header">
                            <span class="collaboration-icon">üí°</span>
                            <h3>Can Help With</h3>
                        </div>
                        <p class="collaboration-text">{{ profile_user.can_help_with }}</p>
                    </div>
                    {% endif %}
                </div>

                {% if not is_own_profile and current_user.is_authenticated %}
                <div class="collaboration-action">
                    <a href="mailto:{{ profile_user.email }}?subject=Collaboration Opportunity" class="btn-collaborate" style="background-color: {{ profile_user.accent_color }};">
                        üìß Reach Out to Collaborate
                    </a>
                </div>
                {% endif %}
            </div>
            {% endif %}

            <!-- What I'm Teaching Now Section -->
            {% if (hasattr(profile_user, 'current_unit_title') and profile_user.current_unit_title) or (hasattr(profile_user, 'current_unit_description') and profile_user.current_unit_description) %}
            <div class="profile-section teaching-now" style="border-color: {{ profile_user.accent_color }};">
                <h2 style="color: {{ profile_user.accent_color }};">üìö What I'm Teaching Now</h2>

                {% if hasattr(profile_user, 'current_unit_updated') and profile_user.current_unit_updated %}
                <p class="last-updated" style="color: #7f8c8d; font-size: 0.9rem; font-style: italic; margin-bottom: 1rem;">
                    Last updated: {{ profile_user.current_unit_updated.strftime('%B %d, %Y') }}
                </p>
                {% endif %}

                <div class="teaching-now-content">
                    {% if hasattr(profile_user, 'current_unit_title') and profile_user.current_unit_title %}
                    <h3 class="unit-title">{{ profile_user.current_unit_title }}</h3>
                    {% endif %}

                    {% if hasattr(profile_user, 'current_unit_subject') and profile_user.current_unit_subject %}
                    <p class="unit-subject"><strong>Subject:</strong> {{ profile_user.current_unit_subject }}</p>
                    {% endif %}

                    {% if hasattr(profile_user, 'current_unit_description') and profile_user.current_unit_description %}
                    <div class="unit-description">
                        {{ profile_user.current_unit_description | nl2br | safe }}
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <!-- Professional Achievements Section -->
            {% if hasattr(profile_user, 'achievements') and profile_user.achievements %}
            <div class="profile-section achievements" style="border-color: {{ profile_user.accent_color }};">
                <h2 style="color: {{ profile_user.accent_color }};">üèÜ Professional Achievements</h2>
                <div class="achievements-list">
                    {{ profile_user.achievements | nl2br | safe }}
                </div>
            </div>
            {% endif %}

            <!-- Teaching Journey Timeline Section -->
            {% if journey_events or is_own_profile %}
            <div class="profile-section teaching-journey" style="border-color: {{ profile_user.accent_color }};">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h2 style="color: {{ profile_user.accent_color }}; margin: 0;">üìÖ Teaching Journey</h2>
                    {% if is_own_profile %}
                    <button onclick="showAddEventModal()" class="btn-add" style="background-color: {{ profile_user.accent_color }};">+ Add Event</button>
                    {% endif %}
                </div>

                {% if journey_events %}
                <div class="timeline">
                    {% for event in journey_events %}
                    <div class="timeline-event" data-event-id="{{ event.id }}">
                        <div class="timeline-year" style="background-color: {{ profile_user.accent_color }};">{{ event.year }}</div>
                        <div class="timeline-content">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <div style="flex: 1;">
                                    <h3>{{ event.title }}</h3>
                                    {% if event.description %}
                                    <p>{{ event.description }}</p>
                                    {% endif %}
                                    {% if event.event_type %}
                                    <span class="event-badge">{{ event.event_type }}</span>
                                    {% endif %}
                                </div>
                                {% if is_own_profile %}
                                <button onclick="deleteEvent({{ event.id }})" class="btn-delete" title="Delete event">√ó</button>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p style="color: #7f8c8d; text-align: center; padding: 2rem;">No timeline events yet. Click "Add Event" to start building your teaching journey!</p>
                {% endif %}
            </div>
            {% endif %}

            <!-- Classroom Showcase Gallery Section -->
            {% if classroom_photos or is_own_profile %}
            <div class="profile-section classroom-gallery" style="border-color: {{ profile_user.accent_color }};">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h2 style="color: {{ profile_user.accent_color }}; margin: 0;">üì∏ Classroom Showcase</h2>
                    {% if is_own_profile %}
                    <button onclick="showUploadPhotoModal()" class="btn-add" style="background-color: {{ profile_user.accent_color }};">+ Upload Photo</button>
                    {% endif %}
                </div>

                {% if classroom_photos %}
                <div class="photo-grid">
                    {% for photo in classroom_photos %}
                    <div class="photo-item" data-photo-id="{{ photo.id }}">
                        {% if is_own_profile %}
                        <button onclick="deletePhoto({{ photo.id }})" class="btn-delete-photo" title="Delete photo">√ó</button>
                        {% endif %}
                        <img src="{{ photo.photo_path }}" alt="{{ photo.caption or 'Classroom photo' }}" loading="lazy">
                        {% if photo.caption %}
                        <p class="photo-caption">{{ photo.caption }}</p>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p style="color: #7f8c8d; text-align: center; padding: 2rem;">No photos yet. Click "Upload Photo" to showcase your classroom!</p>
                {% endif %}
            </div>
            {% endif %}

            <!-- Favorite Lessons Showcase Section -->
            {% if favorite_lessons or is_own_profile %}
            <div class="profile-section favorite-lessons" style="border-color: {{ profile_user.accent_color }};">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h2 style="color: {{ profile_user.accent_color }}; margin: 0;">‚≠ê Favorite Lessons</h2>
                    {% if is_own_profile %}
                    <button onclick="showAddLessonModal()" class="btn-add" style="background-color: {{ profile_user.accent_color }};">+ Add Lesson</button>
                    {% endif %}
                </div>

                {% if favorite_lessons %}
                <div class="lessons-showcase">
                    {% for lesson in favorite_lessons %}
                    <div class="lesson-card" data-lesson-id="{{ lesson.id }}">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                            <h3 class="lesson-title" style="margin: 0;">{{ lesson.title }}</h3>
                            {% if is_own_profile %}
                            <button onclick="deleteLesson({{ lesson.id }})" class="btn-delete" title="Delete lesson">√ó</button>
                            {% endif %}
                        </div>
                        <div class="lesson-meta">
                            {% if lesson.subject %}<span class="lesson-subject">üìö {{ lesson.subject }}</span>{% endif %}
                            {% if lesson.grade_level %}<span class="lesson-grade">üéì {{ lesson.grade_level }}</span>{% endif %}
                            {% if lesson.duration %}<span class="lesson-duration">‚è±Ô∏è {{ lesson.duration }}</span>{% endif %}
                        </div>
                        <p class="lesson-description">{{ lesson.description }}</p>
                        {% if lesson.learning_objectives %}
                        <div class="lesson-objectives">
                            <strong>Learning Objectives:</strong>
                            <p>{{ lesson.learning_objectives }}</p>
                        </div>
                        {% endif %}
                        {% if lesson.materials_needed %}
                        <div class="lesson-materials">
                            <strong>Materials:</strong>
                            <p>{{ lesson.materials_needed }}</p>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p style="color: #7f8c8d; text-align: center; padding: 2rem;">No favorite lessons yet. Click "Add Lesson" to showcase your best lessons! (Max 5)</p>
                {% endif %}
            </div>
            {% endif %}

            <!-- Favorite Resources Section -->
            {% if favorites %}
            <div class="profile-section profile-favorites" style="border-color: {{ profile_user.accent_color }};">
                <h2 style="color: {{ profile_user.accent_color }};">Favorite Resources</h2>
                <div class="profile-resources-grid">
                    {% for resource in favorites %}
                    <div class="profile-resource-card">
                        <h3>{{ resource.name }}</h3>
                        <p class="resource-mini-desc">{{ resource.description[:100] }}...</p>
                        <a href="{{ resource.url }}" target="_blank" rel="noopener noreferrer" class="resource-link" style="color: {{ profile_user.accent_color }};">
                            Visit ‚Üí
                        </a>
                    </div>
                    {% endfor %}
                </div>
                {% if total_favorites > 12 %}
                <p class="more-favorites">And {{ total_favorites - 12 }} more favorites...</p>
                {% endif %}
            </div>
            {% endif %}

            <!-- Contact/Links Section -->
            {% if profile_user.website or (hasattr(profile_user, 'twitter_handle') and profile_user.twitter_handle) %}
            <div class="profile-section" style="border-color: {{ profile_user.accent_color }};">
                <h2 style="color: {{ profile_user.accent_color }};">Connect</h2>
                <div class="profile-links">
                    {% if profile_user.website %}
                    <a href="{{ profile_user.website }}" target="_blank" rel="noopener noreferrer" class="profile-link" style="color: {{ profile_user.accent_color }};">
                        üåê Website
                    </a>
                    {% endif %}
                    {% if hasattr(profile_user, 'twitter_handle') and profile_user.twitter_handle %}
                    <a href="https://twitter.com/{{ profile_user.twitter_handle }}" target="_blank" rel="noopener noreferrer" class="profile-link" style="color: {{ profile_user.accent_color }};">
                        üê¶ @{{ profile_user.twitter_handle }}
                    </a>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <!-- Recent Visitors Section -->
            {% if recent_visitors and is_own_profile %}
            <div class="profile-section" style="border-color: {{ profile_user.accent_color }};">
                <h2 style="color: {{ profile_user.accent_color }};">Recent Visitors</h2>
                <div class="recent-visitors">
                    {% for visitor in recent_visitors %}
                    <a href="{{ url_for('main.profile', username=visitor.username) }}" class="visitor-link" style="border-color: {{ profile_user.accent_color }};">
                        <div class="visitor-avatar">{{ visitor.username[0].upper() }}</div>
                        <span>{{ visitor.display_name or visitor.username }}</span>
                    </a>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
.profile-room {
    transition: background-color 0.3s ease;
}

.profile-container {
    max-width: 1200px;
    margin: 0 auto;
}

/* Favorite Quote Banner */
.quote-banner {
    background: rgba(255,255,255,0.95);
    border-radius: 12px;
    padding: 2rem 3rem;
    margin-bottom: 2rem;
    text-align: center;
    border-left: 5px solid;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    position: relative;
}

.quote-mark {
    font-size: 4rem;
    opacity: 0.2;
    font-family: Georgia, serif;
    line-height: 1;
}

.quote-mark.left {
    position: absolute;
    left: 1rem;
    top: 0.5rem;
}

.quote-mark.right {
    position: absolute;
    right: 1rem;
    bottom: 0.5rem;
}

.quote-text {
    font-size: 1.5rem;
    font-style: italic;
    color: #2c3e50;
    margin: 0;
    font-weight: 500;
    line-height: 1.6;
}

/* Profile Avatar with Image Support */
.profile-avatar {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 3rem;
    font-weight: bold;
    flex-shrink: 0;
    overflow: hidden;
    border: 4px solid rgba(255,255,255,0.9);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.avatar-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* Experience Badge */
.experience-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.6rem 1.2rem;
    border-radius: 20px;
    font-weight: 600;
    margin: 0.5rem 0;
    border: 2px solid;
    transition: all 0.2s;
}

.experience-badge.new-teacher {
    background: #e8f5e9;
    color: #2e7d32;
    border-color: #66bb6a;
}

.experience-badge.experienced {
    background: #e3f2fd;
    color: #1565c0;
    border-color: #42a5f5;
}

.experience-badge.veteran {
    background: #f3e5f5;
    color: #6a1b9a;
    border-color: #ab47bc;
}

.experience-badge.master {
    background: #fff8e1;
    color: #f57f17;
    border-color: #ffd54f;
}

.badge-icon {
    font-size: 1.4rem;
}

.badge-text {
    font-size: 1rem;
}

/* Location Display */
.profile-location {
    margin: 0.3rem 0;
    color: #555;
    font-weight: 500;
}

/* Collaboration Board */
.collaboration-board {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
}

.collaboration-intro {
    color: #7f8c8d;
    font-style: italic;
    margin-bottom: 1.5rem;
    text-align: center;
}

.collaboration-content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

.collaboration-item {
    background: rgba(255,255,255,0.8);
    padding: 1.5rem;
    border-radius: 8px;
    border-left: 4px solid;
    transition: all 0.2s;
}

.collaboration-item.looking-for {
    border-color: #3498db;
}

.collaboration-item.can-help {
    border-color: #2ecc71;
}

.collaboration-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.collaboration-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1rem;
}

.collaboration-icon {
    font-size: 1.5rem;
}

.collaboration-header h3 {
    margin: 0;
    font-size: 1.2rem;
    color: #2c3e50;
}

.collaboration-text {
    color: #555;
    line-height: 1.6;
    margin: 0;
    white-space: pre-wrap;
}

.collaboration-action {
    text-align: center;
    padding-top: 1rem;
    border-top: 2px dashed rgba(0,0,0,0.1);
}

.btn-collaborate {
    display: inline-block;
    color: white;
    text-decoration: none;
    padding: 0.8rem 2rem;
    border-radius: 8px;
    font-weight: 600;
    transition: all 0.2s;
}

.btn-collaborate:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.2);
}

/* What I'm Teaching Now */
.teaching-now .unit-title {
    font-size: 1.5rem;
    color: #2c3e50;
    margin-bottom: 0.5rem;
}

.teaching-now .unit-subject {
    color: #555;
    margin-bottom: 1rem;
}

.teaching-now .unit-description {
    background: rgba(255,255,255,0.5);
    padding: 1rem;
    border-radius: 8px;
    color: #555;
    line-height: 1.6;
}

/* Professional Achievements */
.achievements-list {
    background: rgba(255,255,255,0.5);
    padding: 1.5rem;
    border-radius: 8px;
    color: #555;
    line-height: 1.8;
}

/* Teaching Journey Timeline */
.timeline {
    position: relative;
    padding-left: 3rem;
}

.timeline::before {
    content: '';
    position: absolute;
    left: 0.5rem;
    top: 0;
    bottom: 0;
    width: 2px;
    background: rgba(0,0,0,0.1);
}

.timeline-event {
    position: relative;
    margin-bottom: 2rem;
}

.timeline-year {
    position: absolute;
    left: -3rem;
    top: 0;
    width: 4rem;
    height: 4rem;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: 0.9rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}

.timeline-content {
    background: rgba(255,255,255,0.6);
    padding: 1.5rem;
    border-radius: 8px;
    margin-left: 1rem;
}

.timeline-content h3 {
    margin: 0 0 0.5rem 0;
    color: #2c3e50;
}

.timeline-content p {
    margin: 0;
    color: #555;
    line-height: 1.6;
}

.event-badge {
    display: inline-block;
    background: rgba(102, 126, 234, 0.1);
    color: #667eea;
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.85rem;
    margin-top: 0.5rem;
}

/* Classroom Gallery */
.photo-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 1rem;
}

.photo-item {
    border-radius: 8px;
    overflow: hidden;
    background: rgba(255,255,255,0.8);
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transition: transform 0.2s;
}

.photo-item:hover {
    transform: translateY(-4px);
    box-shadow: 0 4px 16px rgba(0,0,0,0.2);
}

.photo-item img {
    width: 100%;
    height: 200px;
    object-fit: cover;
}

.photo-caption {
    padding: 0.75rem;
    color: #555;
    font-size: 0.9rem;
    margin: 0;
}

/* Favorite Lessons */
.lessons-showcase {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.lesson-card {
    background: rgba(255,255,255,0.6);
    padding: 1.5rem;
    border-radius: 8px;
    border-left: 4px solid #f39c12;
}

.lesson-title {
    margin: 0 0 1rem 0;
    color: #2c3e50;
    font-size: 1.3rem;
}

.lesson-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-bottom: 1rem;
}

.lesson-meta span {
    background: rgba(255,255,255,0.8);
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.9rem;
    color: #555;
}

.lesson-description {
    color: #555;
    line-height: 1.6;
    margin-bottom: 1rem;
}

.lesson-objectives,
.lesson-materials {
    background: rgba(255,255,255,0.4);
    padding: 1rem;
    border-radius: 6px;
    margin-top: 1rem;
}

.lesson-objectives strong,
.lesson-materials strong {
    color: #2c3e50;
    display: block;
    margin-bottom: 0.5rem;
}

.lesson-objectives p,
.lesson-materials p {
    margin: 0;
    color: #555;
    line-height: 1.6;
}

.profile-header {
    background: rgba(255,255,255,0.9);
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 2rem;
    display: flex;
    gap: 2rem;
    align-items: center;
    border-left: 5px solid;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}

.profile-avatar {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 3rem;
    font-weight: bold;
    flex-shrink: 0;
}

.profile-info {
    flex: 1;
}

.profile-name {
    font-size: 2.5rem;
    margin: 0 0 0.5rem 0;
    color: #2c3e50;
}

.profile-username {
    font-size: 1.2rem;
    color: #7f8c8d;
    margin: 0 0 1rem 0;
}

.profile-school,
.profile-grades,
.profile-subjects {
    margin: 0.3rem 0;
    color: #555;
}

.profile-stats {
    display: flex;
    gap: 2rem;
    margin-top: 1rem;
    flex-wrap: wrap;
}

.stat-item {
    font-size: 0.95rem;
}

.profile-actions {
    margin-top: 1rem;
}

.btn-edit-profile {
    display: inline-block;
    color: white;
    text-decoration: none;
    padding: 0.7rem 1.5rem;
    border-radius: 8px;
    font-weight: 600;
    transition: transform 0.2s;
}

.btn-edit-profile:hover {
    transform: translateY(-2px);
}

.profile-content-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 2rem;
}

.profile-section {
    background: rgba(255,255,255,0.9);
    border-radius: 12px;
    padding: 2rem;
    border-left: 5px solid;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}

.profile-section h2 {
    margin-top: 0;
    font-size: 1.8rem;
}

.profile-section p {
    line-height: 1.8;
    color: #555;
}

.profile-resources-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
}

.profile-resource-card {
    background: rgba(248, 249, 250, 0.8);
    padding: 1rem;
    border-radius: 8px;
    transition: transform 0.2s;
}

.profile-resource-card:hover {
    transform: translateY(-2px);
}

.profile-resource-card h3 {
    margin: 0 0 0.5rem 0;
    color: #2c3e50;
    font-size: 1.1rem;
}

.resource-mini-desc {
    font-size: 0.9rem;
    color: #666;
    margin: 0.5rem 0;
}

.resource-link {
    text-decoration: none;
    font-weight: 600;
    display: inline-block;
    margin-top: 0.5rem;
}

.resource-link:hover {
    text-decoration: underline;
}

.more-favorites {
    text-align: center;
    margin-top: 1rem;
    font-style: italic;
    color: #666;
}

.profile-links {
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
}

.profile-link {
    text-decoration: none;
    font-size: 1.1rem;
    font-weight: 600;
    transition: transform 0.2s;
    display: inline-block;
}

.profile-link:hover {
    transform: translateX(5px);
    text-decoration: underline;
}

.recent-visitors {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-top: 1rem;
}

.visitor-link {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    text-decoration: none;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    background: rgba(248, 249, 250, 0.8);
    border: 2px solid;
    transition: all 0.2s;
}

.visitor-link:hover {
    transform: translateY(-2px);
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.visitor-avatar {
    width: 35px;
    height: 35px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
}

.visitor-link span {
    color: #2c3e50;
    font-weight: 600;
}

/* Google Classroom Integration Styles */
.btn-connect-google {
    display: inline-flex;
    align-items: center;
    background: white;
    color: #4285F4;
    border: 2px solid #4285F4;
    padding: 0.7rem 1.5rem;
    border-radius: 8px;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.2s;
    margin-top: 0.5rem;
}

.btn-connect-google:hover {
    background: #4285F4;
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(66, 133, 244, 0.3);
}

.google-classroom-status {
    margin-top: 0.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
}

.connected-badge {
    background: #e8f5e9;
    color: #2e7d32;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.btn-disconnect {
    background: #f8f9fa;
    color: #dc3545;
    border: 1px solid #dc3545;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
}

.btn-disconnect:hover {
    background: #dc3545;
    color: white;
}

@media (max-width: 768px) {
    .profile-header {
        flex-direction: column;
        text-align: center;
    }

    .profile-avatar {
        width: 100px;
        height: 100px;
        font-size: 2.5rem;
    }

    .profile-name {
        font-size: 2rem;
    }

    .profile-stats {
        flex-direction: column;
        gap: 0.5rem;
    }

    .profile-resources-grid {
        grid-template-columns: 1fr;
    }

    .collaboration-content {
        grid-template-columns: 1fr;
    }

    .timeline {
        padding-left: 2rem;
    }

    .timeline-year {
        left: -2rem;
        width: 3rem;
        height: 3rem;
        font-size: 0.8rem;
    }

    .photo-grid {
        grid-template-columns: 1fr;
    }

    .quote-banner {
        padding: 1.5rem 2rem;
    }

    .quote-text {
        font-size: 1.2rem;
    }

    .quote-mark {
        font-size: 3rem;
    }

    .experience-badge {
        justify-content: center;
    }
}

/* Button styles for CRUD operations */
.btn-add {
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 6px;
    color: white;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
}

.btn-add:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.btn-delete {
    background: #dc3545;
    color: white;
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    font-size: 20px;
    line-height: 1;
    cursor: pointer;
    transition: all 0.2s;
    flex-shrink: 0;
}

.btn-delete:hover {
    background: #c82333;
    transform: scale(1.1);
}

.btn-delete-photo {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    background: rgba(220, 53, 69, 0.9);
    color: white;
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    font-size: 20px;
    line-height: 1;
    cursor: pointer;
    transition: all 0.2s;
    z-index: 10;
}

.btn-delete-photo:hover {
    background: #c82333;
    transform: scale(1.1);
}

/* Modal styles */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
    animation: fadeIn 0.2s;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.modal-content {
    background-color: white;
    margin: 5% auto;
    padding: 2rem;
    border-radius: 12px;
    width: 90%;
    max-width: 600px;
    max-height: 80vh;
    overflow-y: auto;
    animation: slideDown 0.3s;
}

@keyframes slideDown {
    from {
        transform: translateY(-50px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
}

.modal-header h3 {
    margin: 0;
    color: #2c3e50;
}

.close {
    font-size: 28px;
    font-weight: bold;
    color: #aaa;
    cursor: pointer;
    transition: color 0.2s;
}

.close:hover {
    color: #000;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: #2c3e50;
}

.form-group input,
.form-group textarea,
.form-group select {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-family: inherit;
    font-size: 1rem;
}

.form-group textarea {
    resize: vertical;
    min-height: 100px;
}

.btn-submit {
    background-color: #667eea;
    color: white;
    padding: 0.75rem 2rem;
    border: none;
    border-radius: 6px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
}

.btn-submit:hover {
    background-color: #5568d3;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

.photo-item {
    position: relative;
}

</style>

<!-- Modals -->
{% if is_own_profile %}

<!-- Add Timeline Event Modal -->
<div id="eventModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Add Timeline Event</h3>
            <span class="close" onclick="closeEventModal()">&times;</span>
        </div>
        <form id="eventForm" onsubmit="addEvent(event)">
            <div class="form-group">
                <label for="event_year">Year *</label>
                <input type="number" id="event_year" name="year" required min="1950" max="2100">
            </div>
            <div class="form-group">
                <label for="event_title">Title *</label>
                <input type="text" id="event_title" name="title" required maxlength="200" placeholder="e.g., Started teaching at Lincoln Elementary">
            </div>
            <div class="form-group">
                <label for="event_description">Description</label>
                <textarea id="event_description" name="description" placeholder="Add details about this milestone..."></textarea>
            </div>
            <div class="form-group">
                <label for="event_type">Event Type</label>
                <select id="event_type" name="event_type">
                    <option value="">Select type...</option>
                    <option value="job">Job/Position</option>
                    <option value="award">Award/Recognition</option>
                    <option value="certification">Certification</option>
                    <option value="milestone">Milestone</option>
                </select>
            </div>
            <button type="submit" class="btn-submit">Add Event</button>
        </form>
    </div>
</div>

<!-- Upload Photo Modal -->
<div id="photoModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Upload Classroom Photo</h3>
            <span class="close" onclick="closePhotoModal()">&times;</span>
        </div>
        <form id="photoForm" onsubmit="uploadPhoto(event)">
            <div class="form-group">
                <label for="photo_file">Photo * (Max 5MB)</label>
                <input type="file" id="photo_file" name="photo" required accept="image/*">
            </div>
            <div class="form-group">
                <label for="photo_caption">Caption</label>
                <input type="text" id="photo_caption" name="caption" maxlength="500" placeholder="Describe your photo...">
            </div>
            <div class="form-group">
                <label for="photo_type">Photo Type</label>
                <select id="photo_type" name="photo_type">
                    <option value="classroom">Classroom</option>
                    <option value="project">Student Project</option>
                    <option value="bulletin_board">Bulletin Board</option>
                </select>
            </div>
            <button type="submit" class="btn-submit">Upload Photo</button>
        </form>
    </div>
</div>

<!-- Add Lesson Modal -->
<div id="lessonModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Add Favorite Lesson</h3>
            <span class="close" onclick="closeLessonModal()">&times;</span>
        </div>
        <form id="lessonForm" onsubmit="addLesson(event)">
            <div class="form-group">
                <label for="lesson_title">Title *</label>
                <input type="text" id="lesson_title" name="title" required maxlength="200" placeholder="Lesson name">
            </div>
            <div class="form-group">
                <label for="lesson_subject">Subject</label>
                <input type="text" id="lesson_subject" name="subject" maxlength="100" placeholder="e.g., Math, Science">
            </div>
            <div class="form-group">
                <label for="lesson_grade">Grade Level</label>
                <input type="text" id="lesson_grade" name="grade_level" maxlength="100" placeholder="e.g., 5th-6th grade">
            </div>
            <div class="form-group">
                <label for="lesson_description">Description *</label>
                <textarea id="lesson_description" name="description" required placeholder="What makes this lesson special?"></textarea>
            </div>
            <div class="form-group">
                <label for="lesson_objectives">Learning Objectives</label>
                <textarea id="lesson_objectives" name="learning_objectives" placeholder="What will students learn?"></textarea>
            </div>
            <div class="form-group">
                <label for="lesson_materials">Materials Needed</label>
                <textarea id="lesson_materials" name="materials_needed" placeholder="List materials required..."></textarea>
            </div>
            <div class="form-group">
                <label for="lesson_duration">Duration</label>
                <input type="text" id="lesson_duration" name="duration" maxlength="100" placeholder="e.g., 45 minutes, 2 class periods">
            </div>
            <button type="submit" class="btn-submit">Add Lesson</button>
        </form>
    </div>
</div>

<script>
// Modal functions
function showAddEventModal() {
    document.getElementById('eventModal').style.display = 'block';
}

function closeEventModal() {
    document.getElementById('eventModal').style.display = 'none';
    document.getElementById('eventForm').reset();
}

function showUploadPhotoModal() {
    document.getElementById('photoModal').style.display = 'block';
}

function closePhotoModal() {
    document.getElementById('photoModal').style.display = 'none';
    document.getElementById('photoForm').reset();
}

function showAddLessonModal() {
    document.getElementById('lessonModal').style.display = 'block';
}

function closeLessonModal() {
    document.getElementById('lessonModal').style.display = 'none';
    document.getElementById('lessonForm').reset();
}

// Close modal when clicking outside
window.onclick = function(event) {
    if (event.target.classList.contains('modal')) {
        event.target.style.display = 'none';
    }
}

// Timeline Event CRUD
async function addEvent(e) {
    e.preventDefault();
    const formData = new FormData(e.target);

    try {
        const response = await fetch('/profile/journey/add', {
            method: 'POST',
            body: formData
        });
        const data = await response.json();

        if (data.success) {
            closeEventModal();
            location.reload();
        } else {
            alert('Error: ' + (data.error || 'Failed to add event'));
        }
    } catch (error) {
        alert('Error adding event: ' + error.message);
    }
}

async function deleteEvent(eventId) {
    if (!confirm('Delete this timeline event?')) return;

    try {
        const response = await fetch(`/profile/journey/${eventId}/delete`, {
            method: 'POST'
        });
        const data = await response.json();

        if (data.success) {
            document.querySelector(`[data-event-id="${eventId}"]`).remove();

            // Show empty message if no events left
            const timeline = document.querySelector('.timeline');
            if (timeline && timeline.children.length === 0) {
                location.reload();
            }
        } else {
            alert('Error: ' + (data.error || 'Failed to delete event'));
        }
    } catch (error) {
        alert('Error deleting event: ' + error.message);
    }
}

// Photo CRUD
async function uploadPhoto(e) {
    e.preventDefault();
    const formData = new FormData(e.target);

    try {
        const response = await fetch('/profile/photos/upload', {
            method: 'POST',
            body: formData
        });
        const data = await response.json();

        if (data.success) {
            closePhotoModal();
            location.reload();
        } else {
            alert('Error: ' + (data.error || 'Failed to upload photo'));
        }
    } catch (error) {
        alert('Error uploading photo: ' + error.message);
    }
}

async function deletePhoto(photoId) {
    if (!confirm('Delete this photo?')) return;

    try {
        const response = await fetch(`/profile/photos/${photoId}/delete`, {
            method: 'POST'
        });
        const data = await response.json();

        if (data.success) {
            document.querySelector(`[data-photo-id="${photoId}"]`).remove();

            // Show empty message if no photos left
            const photoGrid = document.querySelector('.photo-grid');
            if (photoGrid && photoGrid.children.length === 0) {
                location.reload();
            }
        } else {
            alert('Error: ' + (data.error || 'Failed to delete photo'));
        }
    } catch (error) {
        alert('Error deleting photo: ' + error.message);
    }
}

// Lesson CRUD
async function addLesson(e) {
    e.preventDefault();
    const formData = new FormData(e.target);

    try {
        const response = await fetch('/profile/lessons/add', {
            method: 'POST',
            body: formData
        });
        const data = await response.json();

        if (data.success) {
            closeLessonModal();
            location.reload();
        } else {
            alert('Error: ' + (data.error || 'Failed to add lesson'));
        }
    } catch (error) {
        alert('Error adding lesson: ' + error.message);
    }
}

async function deleteLesson(lessonId) {
    if (!confirm('Delete this lesson?')) return;

    try {
        const response = await fetch(`/profile/lessons/${lessonId}/delete`, {
            method: 'POST'
        });
        const data = await response.json();

        if (data.success) {
            document.querySelector(`[data-lesson-id="${lessonId}"]`).remove();

            // Show empty message if no lessons left
            const showcase = document.querySelector('.lessons-showcase');
            if (showcase && showcase.children.length === 0) {
                location.reload();
            }
        } else {
            alert('Error: ' + (data.error || 'Failed to delete lesson'));
        }
    } catch (error) {
        alert('Error deleting lesson: ' + error.message);
    }
}
</script>

{% endif %}

{% endblock %}
