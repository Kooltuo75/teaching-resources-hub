{% extends "base.html" %}

{% block title %}Upload Resource - {{ app_name }}{% endblock %}

{% block content %}
<div class="upload-container">
    <div class="upload-header">
        <h1>üì§ Upload Resource</h1>
        <p>Share your teaching materials with the community</p>
    </div>

    <form method="POST" enctype="multipart/form-data" class="upload-form" id="uploadForm">
        <!-- File Upload Section -->
        <div class="form-section">
            <h2>üìé Select File</h2>

            <div class="file-upload-area" id="fileUploadArea">
                <div class="upload-icon">üìÅ</div>
                <div class="upload-text">
                    <strong>Click to browse</strong> or drag and drop your file here
                </div>
                <div class="upload-hint">
                    Supported: PDF, DOC, DOCX, PPT, PPTX, XLS, XLSX, JPG, PNG, GIF, TXT, ZIP (Max 50MB)
                </div>
                <input type="file"
                       name="file"
                       id="fileInput"
                       required
                       accept=".pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.jpg,.jpeg,.png,.gif,.txt,.zip">
            </div>

            <div id="filePreview" class="file-preview" style="display: none;">
                <div class="file-info">
                    <div class="file-icon-large" id="fileIcon">üìÑ</div>
                    <div class="file-details">
                        <div class="file-name" id="fileName"></div>
                        <div class="file-size" id="fileSize"></div>
                    </div>
                    <button type="button" onclick="clearFile()" class="btn-clear">‚úï</button>
                </div>
            </div>
        </div>

        <!-- Resource Details -->
        <div class="form-section">
            <h2>üìù Resource Details</h2>

            <div class="form-group">
                <label for="title">Title *</label>
                <input type="text"
                       name="title"
                       id="title"
                       required
                       maxlength="200"
                       placeholder="e.g., 5th Grade Math Fractions Worksheet"
                       class="form-control">
            </div>

            <div class="form-group">
                <label for="description">Description</label>
                <textarea name="description"
                          id="description"
                          rows="4"
                          placeholder="Describe what this resource is for, how to use it, and what makes it valuable..."
                          class="form-control"></textarea>
            </div>
        </div>

        <!-- Metadata -->
        <div class="form-section">
            <h2>üè∑Ô∏è Metadata</h2>

            <div class="form-row">
                <div class="form-group">
                    <label for="category">Subject/Category</label>
                    <select name="category" id="category" class="form-control">
                        <option value="">Select a category...</option>
                        <option value="Mathematics">Mathematics</option>
                        <option value="Science">Science</option>
                        <option value="English/Language Arts">English/Language Arts</option>
                        <option value="Social Studies">Social Studies</option>
                        <option value="Computer Science">Computer Science</option>
                        <option value="Arts">Arts</option>
                        <option value="Physical Education">Physical Education</option>
                        <option value="Special Education">Special Education</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="grade_level">Grade Level</label>
                    <select name="grade_level" id="grade_level" class="form-control">
                        <option value="">Select grade level...</option>
                        <option value="Pre-K">Pre-K</option>
                        <option value="Kindergarten">Kindergarten</option>
                        <option value="1st Grade">1st Grade</option>
                        <option value="2nd Grade">2nd Grade</option>
                        <option value="3rd Grade">3rd Grade</option>
                        <option value="4th Grade">4th Grade</option>
                        <option value="5th Grade">5th Grade</option>
                        <option value="6th Grade">6th Grade</option>
                        <option value="7th Grade">7th Grade</option>
                        <option value="8th Grade">8th Grade</option>
                        <option value="9th Grade">9th Grade</option>
                        <option value="10th Grade">10th Grade</option>
                        <option value="11th Grade">11th Grade</option>
                        <option value="12th Grade">12th Grade</option>
                        <option value="College">College</option>
                        <option value="All Grades">All Grades</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="difficulty">Difficulty</label>
                    <select name="difficulty" id="difficulty" class="form-control">
                        <option value="Easy">Easy</option>
                        <option value="Medium" selected>Medium</option>
                        <option value="Hard">Hard</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="duration">Duration</label>
                    <input type="text"
                           name="duration"
                           id="duration"
                           placeholder="e.g., 45 minutes, 1 class period"
                           class="form-control">
                </div>
            </div>

            <div class="form-group">
                <label for="tags">Tags (comma-separated)</label>
                <input type="text"
                       name="tags"
                       id="tags"
                       placeholder="e.g., fractions, decimals, word problems"
                       class="form-control">
                <small class="form-hint">Add keywords to help others find your resource</small>
            </div>

            <div class="form-group">
                <label for="standards">Educational Standards</label>
                <input type="text"
                       name="standards"
                       id="standards"
                       placeholder="e.g., Common Core Math 5.NF.A.1"
                       class="form-control">
            </div>
        </div>

        <!-- Visibility -->
        <div class="form-section">
            <h2>üëÅÔ∏è Visibility</h2>

            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" name="is_public" value="true" checked>
                    <span class="checkbox-text">
                        <strong>Make this resource public</strong><br>
                        <small>Other teachers will be able to view and download this resource</small>
                    </span>
                </label>
            </div>
        </div>

        <!-- Submit Buttons -->
        <div class="form-actions">
            <a href="{{ url_for('main.my_resources') }}" class="btn-cancel">Cancel</a>
            <button type="submit" class="btn-submit" id="submitBtn">
                <span id="submitText">üì§ Upload Resource</span>
                <span id="uploadingText" style="display: none;">‚è≥ Uploading...</span>
            </button>
        </div>
    </form>
</div>

<script>
const fileUploadArea = document.getElementById('fileUploadArea');
const fileInput = document.getElementById('fileInput');
const filePreview = document.getElementById('filePreview');
const uploadForm = document.getElementById('uploadForm');
const submitBtn = document.getElementById('submitBtn');

// Click to upload
fileUploadArea.addEventListener('click', () => fileInput.click());

// Drag and drop
fileUploadArea.addEventListener('dragover', (e) => {
    e.preventDefault();
    fileUploadArea.classList.add('drag-over');
});

fileUploadArea.addEventListener('dragleave', () => {
    fileUploadArea.classList.remove('drag-over');
});

fileUploadArea.addEventListener('drop', (e) => {
    e.preventDefault();
    fileUploadArea.classList.remove('drag-over');

    if (e.dataTransfer.files.length) {
        fileInput.files = e.dataTransfer.files;
        handleFileSelect();
    }
});

// File selection
fileInput.addEventListener('change', handleFileSelect);

function handleFileSelect() {
    const file = fileInput.files[0];
    if (!file) return;

    // Check file size
    const maxSize = 50 * 1024 * 1024; // 50MB
    if (file.size > maxSize) {
        alert('File is too large. Maximum size is 50MB.');
        clearFile();
        return;
    }

    // Show file preview
    document.getElementById('fileName').textContent = file.name;
    document.getElementById('fileSize').textContent = formatFileSize(file.size);

    // Set icon based on file type
    const ext = file.name.split('.').pop().toLowerCase();
    const iconMap = {
        'pdf': 'üìÑ',
        'doc': 'üìù', 'docx': 'üìù',
        'ppt': 'üìä', 'pptx': 'üìä',
        'xls': 'üìà', 'xlsx': 'üìà',
        'jpg': 'üñºÔ∏è', 'jpeg': 'üñºÔ∏è', 'png': 'üñºÔ∏è', 'gif': 'üñºÔ∏è',
        'zip': 'üóúÔ∏è',
        'txt': 'üìÉ'
    };
    document.getElementById('fileIcon').textContent = iconMap[ext] || 'üìÅ';

    fileUploadArea.style.display = 'none';
    filePreview.style.display = 'block';

    // Auto-fill title if empty
    if (!document.getElementById('title').value) {
        const titleWithoutExt = file.name.replace(/\.[^/.]+$/, '');
        document.getElementById('title').value = titleWithoutExt;
    }
}

function clearFile() {
    fileInput.value = '';
    fileUploadArea.style.display = 'flex';
    filePreview.style.display = 'none';
}

function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
}

// Form submission
uploadForm.addEventListener('submit', function(e) {
    submitBtn.disabled = true;
    document.getElementById('submitText').style.display = 'none';
    document.getElementById('uploadingText').style.display = 'inline';
});
</script>

<style>
.upload-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
}

.upload-header {
    text-align: center;
    margin-bottom: 40px;
}

.upload-header h1 {
    margin: 0 0 10px 0;
    color: #1f2937;
    font-size: 2.5em;
}

.upload-header p {
    color: #6b7280;
    font-size: 1.1em;
}

.upload-form {
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.form-section {
    padding: 30px;
    border-bottom: 1px solid #e5e7eb;
}

.form-section:last-of-type {
    border-bottom: none;
}

.form-section h2 {
    margin: 0 0 20px 0;
    color: #1f2937;
    font-size: 1.4em;
}

.file-upload-area {
    border: 3px dashed #d1d5db;
    border-radius: 12px;
    padding: 60px 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
}

.file-upload-area:hover,
.file-upload-area.drag-over {
    border-color: #667eea;
    background: #f9fafb;
}

.upload-icon {
    font-size: 4em;
}

.upload-text {
    font-size: 1.1em;
    color: #4b5563;
}

.upload-hint {
    font-size: 0.9em;
    color: #9ca3af;
}

#fileInput {
    display: none;
}

.file-preview {
    background: #f9fafb;
    border-radius: 12px;
    padding: 20px;
}

.file-info {
    display: flex;
    align-items: center;
    gap: 15px;
}

.file-icon-large {
    font-size: 3em;
}

.file-details {
    flex: 1;
}

.file-name {
    font-weight: 600;
    color: #1f2937;
    margin-bottom: 5px;
}

.file-size {
    color: #6b7280;
    font-size: 0.9em;
}

.btn-clear {
    padding: 8px 12px;
    background: #ef4444;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 1.2em;
    transition: all 0.3s ease;
}

.btn-clear:hover {
    background: #dc2626;
}

.form-group {
    margin-bottom: 20px;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

.form-group label {
    display: block;
    font-weight: 600;
    color: #374151;
    margin-bottom: 8px;
}

.form-control {
    width: 100%;
    padding: 12px;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    font-size: 1em;
    transition: border-color 0.3s ease;
    box-sizing: border-box;
}

.form-control:focus {
    outline: none;
    border-color: #667eea;
}

textarea.form-control {
    resize: vertical;
    font-family: inherit;
}

.form-hint {
    display: block;
    margin-top: 6px;
    font-size: 0.85em;
    color: #6b7280;
}

.checkbox-label {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    cursor: pointer;
}

.checkbox-label input[type="checkbox"] {
    margin-top: 4px;
    width: 20px;
    height: 20px;
    cursor: pointer;
}

.checkbox-text {
    color: #4b5563;
}

.form-actions {
    padding: 30px;
    display: flex;
    gap: 15px;
    justify-content: flex-end;
}

.btn-cancel {
    padding: 12px 30px;
    background: #f3f4f6;
    color: #4b5563;
    text-decoration: none;
    border-radius: 8px;
    font-weight: 600;
    transition: all 0.3s ease;
}

.btn-cancel:hover {
    background: #e5e7eb;
}

.btn-submit {
    padding: 12px 30px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    font-size: 1em;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-submit:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

.btn-submit:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

@media (max-width: 768px) {
    .form-row {
        grid-template-columns: 1fr;
    }

    .form-actions {
        flex-direction: column-reverse;
    }

    .btn-cancel, .btn-submit {
        width: 100%;
        text-align: center;
    }
}
</style>
{% endblock %}
